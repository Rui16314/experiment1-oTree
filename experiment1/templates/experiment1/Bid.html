{% extends "experiment1/BaseAuction.html" %}
{% block page_title %}Submit your bid{% endblock %}

{% block page_body %}
<p class="muted">Session {{ session_no }} — Round {{ round_in_session }} of {{ ROUNDS_PER_SESSION }}</p>

<p>Your valuation for this round is <b>{{ valuation }}</b>.</p>

{% if chat_enabled %}
  <div class="chat">
    <div><b>Chat with your opponent (before you bid)</b></div>
    <div id="msgs" class="chat-messages"></div>
    <div class="input-group">
      <input id="msg" class="form-control" type="text" placeholder="Type a message…">
      <button class="btn btn-primary" type="button" onclick="sendMsg()">Send</button>
    </div>
  </div>
{% endif %}

<form method="post">
  {% formfield player.bid label="Bid" %}
  <button class="btn btn-primary" type="submit">Next</button>
</form>

{% if chat_enabled %}
<script>
  const msgsEl = document.getElementById('msgs');
  const inputEl = document.getElementById('msg');

  function append(sender, text) {
    const row = document.createElement('div');
    row.className = 'chat-row';
    row.textContent = `[P${sender}] ${text}`;
    msgsEl.appendChild(row);
    msgsEl.scrollTop = msgsEl.scrollHeight;
  }

  function liveRecv(data) {
    if (data && data.text) {
      append(data.sender, data.text);
    }
  }

  function sendMsg() {
    const t = (inputEl.value || '').trim();
    if (!t) return;
    liveSend({text: t});
    append('{{ player.id_in_group }}', t); // local echo
    inputEl.value = '';
    inputEl.focus();
  }
</script>
{% endif %}
{% endblock %}



