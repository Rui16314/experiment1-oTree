{% load otree %}
{% extends "experiment1/BaseAuction.html" %}

{% block page_title %}Chat (before bidding){% endblock %}

{% block page_body %}
  <p class="text-muted">Session {{ session_no }} — Round {{ round_in_session }} of {{ ROUNDS_PER_SESSION }}</p>

  <ul id="log" style="height:200px; overflow:auto; border:1px solid #ddd; padding:8px; margin-bottom:8px;"></ul>

  <div class="input-group" style="max-width:520px;">
    <input id="msg" type="text" class="form-control" placeholder="Type a message…">
    <button class="btn btn-primary" type="button" onclick="sendMsg()">Send</button>
  </div>

  <div class="mt-3">{% next_button %}</div>

  <script>
    function sendMsg(){
      const el = document.getElementById('msg');
      const t = el.value.trim();
      if(!t) return;
      liveSend({text: t});
      el.value = '';
    }
    function liveRecv(data){
      const ul = document.getElementById('log');
      (data.messages || []).forEach(m => {
        const li = document.createElement('li');
        li.textContent = m;
        ul.appendChild(li);
        ul.scrollTop = ul.scrollHeight;
      });
    }
  </script>
{% endblock %}
